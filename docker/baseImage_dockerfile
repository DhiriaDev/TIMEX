#syntax=docker/dockerfile:1

FROM archlinux:base-20221113.0.102112

ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    PIP_DISABLE_PIP_VERSION_CHECK=on \
    POETRY_HOME="/opt/poetry" \
    POETRY_NO_INTERACTION=1

# prepend poetry and venv to path
ENV PATH="$POETRY_HOME/bin:$PATH"

RUN pacman -Syy
RUN pacman -Syu --noconfirm python base-devel

RUN python -m ensurepip
RUN python -m pip install --no-cache-dir poetry
RUN poetry self update

WORKDIR /timexdocker
ADD TIMEX ./TIMEX
ADD entrypoints/go/watcher ./

ADD pyproject.toml poetry.lock ./
RUN poetry config virtualenvs.create false \
    && poetry update 
